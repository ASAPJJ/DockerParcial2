<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplicación Web para Consumo de Servicios SOAP y REST</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
    <script>
        // Cargar datos cuando la página se inicia
        window.onload = function() {
            consultarConRest();
        };

        function insertarConSoap() {
            var apellido = document.getElementById('apellido').value;
            var nombre = document.getElementById('nombre').value;
            var dni = document.getElementById('dni').value;

            // Construcción del cuerpo del mensaje SOAP
            var soapRequest =
                `<s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/">
                    <s:Body>
                        <InsertarPersona xmlns="http://tu-namespace-aquí">
                            <Apellido>${apellido}</Apellido>
                            <Nombre>${nombre}</Nombre>
                            <DNI>${dni}</DNI>
                        </InsertarPersona>
                    </s:Body>
                </s:Envelope>`;

            fetch('http://localhost:8080/insertar_con_soap', {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/xml',
                    'SOAPAction': 'http://tu-namespace-aquí/InsertarPersona'
                },
                body: soapRequest
            })
            .then(response => response.text())
            .then(responseXML => {
                // Procesar la respuesta SOAP
                console.log(responseXML);
                // Llamar a la función para actualizar la lista de personas
                consultarConRest();
            })
            .catch(error => console.error('Error:', error));
        }

        function consultarConRest() {
            fetch('http://localhost:8888/consultar_con_rest')
            .then(response => response.json())
            .then(data => {
                var tabla = document.getElementById('tablaPersonas');
                tabla.innerHTML = "<tr><th>Apellido</th><th>Nombre</th><th>DNI</th></tr>";
                data.forEach(persona => {
                    tabla.innerHTML += `<tr><td>${persona.Apellido}</td><td>${persona.Nombre}</td><td>${persona.DNI}</td></tr>`;
                });
            })
            .catch(error => console.error('Error:', error));
        }

        function agregarPersona(event) {
            event.preventDefault();
            var apellido = document.getElementById('apellido');
            var nombre = document.getElementById('nombre');
            var dni = document.getElementById('dni');

            fetch('http://localhost:8080/insertar_con_rest', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({"Apellido": apellido.value, "Nombre": nombre.value, "DNI": dni.value})
            })
            .then(response => response.json())
            .then(data => {
                alert("Persona agregada con éxito");
                apellido.value = '';
                nombre.value = '';
                dni.value = '';
                consultarConRest(); // Recargar los datos
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        }
        
    </script>
</head>
<body>
    <h1>Consumir Servicio SOAP y REST</h1>

    <!-- Formulario para agregar nuevas personas -->
    <form onSubmit="agregarPersona(event);">
        <input type="text" id="apellido" placeholder="Apellido" required />
        <input type="text" id="nombre" placeholder="Nombre" required />
        <input type="text" id="dni" placeholder="DNI" required />
        <input type="submit" value="Agregar Persona" />
    </form>

    <h2>Listado de Personas</h2>
    <table id="tablaPersonas">
    </table>
</body>
</html>
